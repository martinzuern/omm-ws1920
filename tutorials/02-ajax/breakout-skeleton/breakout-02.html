<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Breakout 02: GitHub Followers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

  <form id="get-form">
    <input type="text" placeholder="username" name="myuser">
    <button type="submit">Load my followees!</button>
  </form>

  <form id="unfollow-form">
    <input type="text" placeholder="username" name="unfollowuser">
    <button type="submit">Unfollow!</button>
  </form>

  <!-- TODO 2) add a second form, where one can enter a username to unfollow -->

  <div id="output"></div>

  <script>

    function getJSON(method, url, callback, params) {
      // TODO 2) maybe some authorization is necessary?
      fetch(url, {
        method: method, // *GET, POST, PUT, DELETE, etc.
        cache: 'no-cache', // otherwise we might not see changes immediately
        headers: {
          'Content-Type': 'application/json'
        },
        body: params // body data type must match "Content-Type" header
      })
      .then(res => res.json())
      .then(callback)
    }


    var getForm = document.querySelector('#get-form');
    var unfollowForm = document.querySelector('#unfollow-form');
    var myUserInput = document.querySelector('input[name=myuser]');
    var UnfollowInput = document.querySelector('input[name=myuser]');
    var output = document.querySelector('#output');

    getForm.addEventListener('submit', function (e) {
      var params;
      e.preventDefault(); // don't submit at this point.

      output.innerHTML = ''

      // TODO 1) load list followees instead of user profile
      getJSON('GET', `https://api.github.com/users/${myUserInput.value}/following`, (followers) => {
        // TODO 1) append one p tag for each followee 
        followers.forEach(follower => {
          output.innerHTML += `<p><img src='${follower.avatar_url}' width="50", height="50">${follower.login}</p>`
        })
      }, null)
    });

    unfollowForm.addEventListener('submit', function (e) {
      var params;
      e.preventDefault(); // don't submit at this point.

      getJSON('DELETE', `https://api.github.com/users/${myUserInput.value}/following`, (followers) => {
        // TODO 1) append one p tag for each followee 
        followers.forEach(follower => {
          output.innerHTML += `<p><img src='${follower.avatar_url}' width="50", height="50">${follower.login}</p>`
        })
      }, null)
    });


 // TODO 2) handle unfollow action
  </script>

</body>

</html>